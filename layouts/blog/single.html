{{ define "main" }}
{{ $alt := "" }}
{{ if .Params.h1 }}
  {{ $alt = .Params.h1 }}
{{ else }}
  {{ $alt = .Title }}
{{ end }}

{{ $imgPath := "" }}
{{ if .Params.image }}
  {{ $imgPath = .Params.image }}
{{ end }}

{{/* Пытаемся найти как ресурс страницы */}}
{{ $pageImage := .Resources.GetMatch $imgPath }}

{{/* Если не найдено — ищем в глобальных assets */}}
{{ $globalImage := false }}
{{ if not $pageImage }}
  {{ $globalImage = resources.Get $imgPath }}
{{ end }}

<!-- blog details -->
<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 order-2 order-lg-1">
        <div class="row">
          <div class="col-12 mb-4">
            <h1 class="h2">{{ with .Params.h1 }}{{ . }}{{ else }}{{ .Title }}{{ end }}</h1>
          </div>
          {{ if $imgPath }}
          <div class="col-12 mb-4">
            {{ if $pageImage }}
              <img src="{{ $pageImage.Permalink }}" alt="{{ $alt }}" class="img-fluid w-100">
            {{ else if $globalImage }}
              {{ partial "image.html" (dict "Src" $globalImage "Alt" $alt "Class" "img-fluid w-100") }}
            {{ else }}
            {{/* Fallback: прямой путь (на случай, если файл в static/) */}}
              <img src="{{ $imgPath | absURL }}" alt="{{ $alt }}" class="img-fluid w-100">
            {{ end }}
          </div>
          {{ end }}
          <div class="col-12">
            <ul class="list-inline">
              {{/*<li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Автор: </span><a
                  href="{{ `author/` | relLangURL }}{{ .Params.Author | urlize }}">{{ .Params.Author | title }}</a></li>*/}}
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light"><span class="font-weight-bold mr-2">Дата: </span>{{ .PublishDate.Format "02.01.2006" }}</li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light">
                <span class="font-weight-bold mr-2">Категория(и):</span>
                {{ range $index, $elements:= .Params.Categories }}
                <a href="{{ `categories/` | relLangURL }}{{ . | urlize | lower }}">
                  {{ . | title }}
                </a>
                {{ if ne $index (sub (len $.Params.Categories) 1) }} | {{ end }}
                {{ end }}
              </li>
              <li class="list-inline-item mr-4 mb-3 mb-md-0 text-light">
                <span class="font-weight-bold mr-2">Теги:</span>
                {{ range $index, $elements:= .Params.Tags }}
                <a href="{{ `tags/` | relLangURL }}{{ . | urlize | lower }}">
                  {{ . | title }}
                </a>
                {{ if ne $index (sub (len $.Params.Tags) 1) }} | {{ end }}
                {{ end }}
              </li>
            </ul>
          </div>
          <!-- border -->
          <div class="col-12 my-4">
            <div class="border-bottom"></div>
          </div>
          <!-- blog contect -->
          <div class="content col-12 mb-5">
            {{ .Content }}
          </div>
          {{ if site.Config.Services.Disqus.Shortname }}
           <!-- Disqus comments -->
          <div class="mt-20">
            {{ template "_internal/disqus.html" . }}
          </div>
          {{ end }}
        </div>
      </div>
      {{ partial "blog-sidebar.html" . }}
    </div>
  </div>
</section>
<!-- /blog details -->

{{ end }}
